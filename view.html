<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>みんなのひとり時間</title>
<style>
body {
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN",Meiryo,"Noto Sans JP",sans-serif;
  margin:0; padding:6vh 4vmin;
  background: linear-gradient(180deg,#f4f6f8 0%,#e8ecef 100%);
  color:#2b333a; text-align:center;
}
h1 { font-size:1.6rem; margin-bottom:1rem; }
iframe {
  width:min(96vw,1080px); height:900px; border:0;
  background:rgba(255,255,255,.6); border-radius:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.05);
}
p.caption { font-size:.9rem; color:#5b6470; margin-top:.6rem; }
</style>
</head>
<body>
<h1>みんなのひとり時間</h1>
<!-- ランダム表示エリア -->
<div id="randomSolo" style="
  margin: 20px auto;
  padding: 16px 20px;
  max-width: 600px;
  background: rgba(255,255,255,0.65);
  border-radius: 14px;
  box-shadow: 0 8px 20px rgba(0,0,0,.05);
  text-align: left;
">
  <div style="font-size:.9rem; color:#5b6470; margin-bottom:6px;">☔ 今日のひとり時間</div>
  <div id="soloTitle" style="font-weight:700; font-size:1.1rem; color:#2b333a; margin-bottom:6px;"></div>
  <div id="soloOne" style="color:#374151; font-size:.95rem; line-height:1.6;"></div>
</div>

<iframe
  src="https://docs.google.com/spreadsheets/d/e/【ここに公開用ID】/pubhtml?widget=true&amp;headers=false"
  title="ひとり時間一覧"></iframe>

<p class="caption">フォームに投稿された内容が自動で反映されます。</p>

<!-- SheetJS (XLSX) CDN -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
(async function() {
  const XLSX_URL = 'solitude_time.xlsx'; // 同じリポジトリ直下にある前提

  try {
    const res = await fetch(XLSX_URL, { cache: 'no-store' });
    if (!res.ok) throw new Error('XLSX fetch failed: ' + res.status);
    const ab = await res.arrayBuffer();

    const wb = XLSX.read(ab, { type: 'array' });
    const ws = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(ws, { defval: '' });

    if (!rows.length) throw new Error('No rows in XLSX');

    // ランダムに1行
    const pick = rows[Math.floor(Math.random() * rows.length)];

    // 列名をExcelに合わせて修正（例:「タイトル」「ひとこと」）
    const title = pick['タイトル'] || pick['title'] || '';
    const one   = pick['ひとこと'] || pick['一言'] || pick['comment'] || '';

    document.getElementById('soloTitle').textContent = title || '（タイトル未設定）';
    document.getElementById('soloOne').textContent = one || '（ひとこと未設定）';
  } catch (err) {
    console.error(err);
    document.getElementById('randomSolo').style.display = 'none';
  }
})();
</script>  
  
</body>
</html>

